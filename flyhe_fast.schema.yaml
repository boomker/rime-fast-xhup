# Rime schema
# encoding: utf-8
---

schema:
  schema_id: flyhe_fast
  name: 飞鹤快码
  version: 2026.02.29
  author:
    - boomker
  description: |
    小鹤双拼+直接辅码
    github.com:boomker/rime-fast-xhup
  # dependencies:
    # - melt_eng         # 中英Mix输入方案

# 选项开关
switches:
  - name: ascii_mode
    states: [中, En]
  - name: ascii_punct
    states: [。, .]
  - name: full_shape
    states: [半, 全]
  - name: traditionalize
    states: [简, 繁]
  - name: extended_charset
    states: [通用, 增廣]
    reset: 1
  - name: char_mode
    states: [词组优先, 单字优先]

# 输入引擎
engine:
  processors:
    - lua_processor@*select_char
    - lua_processor@*symbol_menu
    - lua_processor@*cand_selector*processor
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - selector
    - navigator
    - punctuator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - matcher@date_time_seg
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
    # - table_translator@melt_eng                     # 英文输入
    - lua_translator@*date_time                       # date/orq,week,time 触发
    - lua_translator@*cand_selector*translator        # /,; 单字或二字词和表情自动上屏
  filters:
    - simplifier@traditionalize                       # 简繁切换
    - lua_filter@*cand_selector*filter
    - uniquifier                                      # 只能放到最后!

# 主翻译器, 小鹤双拼
translator:
  dictionary: flyhe_fast
  spelling_hints: 1                 # >0 启用, `0`: 关闭单字编码提示
  max_word_length: 7                # >0 启用, 过长短语不记整词, 只加元素权重
  core_word_length: 4               # >0 启用, 按段学词 + 相邻段拼接
  initial_quality: 1.1
  enable_sentence: false
  enable_user_dict: true            # 开启用户词库
  enable_completion: true           # 启用输入补全
  encode_commit_history: false      # 历史上屏自动编码成词
  enable_word_completion: false     # 4 音节以上的词条才补全
  contextual_suggestions: false     # 开启语言模型优化候选
  sentence_over_completion: false
  # max_homophones: 7
  # max_homographs: 7
  # max_phrase_length: 5
  # strict_spelling: true           # 配合fuzz(简拼)运算〔仅table_translator有效〕
  # always_show_comments: true      # 始终显示提示码〔仅script_translator有效〕
  # disable_user_dict_for_patterns:
  #   - '^[a-z][a-z]?$'             # 单字不调频
  preedit_format:
    __include: preedit_convert_rules     # 输入码显示为全拼
  comment_format:
    - xform/^(.*)/~$1/

# 次翻译器
melt_eng:
  dictionary: melt_eng              # 挂载词库 melt_eng.dict.yaml
  enable_sentence: false            # 禁止造句
  enable_user_dict: false           # 禁用用户词典
  initial_quality: 0.8              # 初始权重
  comment_format:                   # 自定义提示码
    - xform/.*//                    # 清空提示码

# 自定义短语
custom_phrase:                      # 自定义固顶字
  dictionary: ""
  db_class: stabledb
  user_dict: custom_phrase
  initial_quality: 99
  enable_sentence: false
  enable_completion: false

# 简体转繁体
traditionalize:                     # 简繁转换
  tips: none                        # 转换提示: all | char 仅单字显示 | none 不显示
  tags: [abc]                       # 限制在对应 tag, 不对其他如反查的内容做简繁转换
  opencc_config: s2t.json           # s2t.json | s2hk.json | s2tw.json | s2twp.json
  option_name: traditionalize

# 处理符合特定规则的输入码，如网址、反查
recognizer:
  import_preset: default
  patterns:
    date_time: '^(/wd|date|orq)[-\+][0-9]*$'    # 日期(可查前后指定N日)
    punct: "^(/([0-9]0?|[A-Za-z]+))|(;[A-Za-z]+)$"
    url: "^(www[.]|https?:|ftp[.:]|mailto:|file:).*$"

date_time_seg:
  patterns:
    time: "^(/wt|time|osj)$"                    # 时间
    week: "^(/wk|week|oxq)$"                    # 星期
    date: '^(/wd|date|orq)$'                    # 日期
    timestamp: "^(/wts|/uts|timestamp|ots)$"    # 时间戳
    week_before_after: "^/(wuz|wlk|wxz|wnk)$"   # 上周下周
    date_before_after: "^/(wqt|wzt|wmt|wht)$"   # [前昨明后]天
    month_before_after: "^/(wuy|wlm|wxy|wnm)$"  # 上个月下个月

# 标点符号
punctuator:
  digit_separators: ".:"                              # 指定要转换为英文半角的符号, 若双击则恢复全角(中文)
  # digit_separator_action: commit                    # 上一行指定的符号在按下数字后的动作行为
  import_preset: symbols
  full_shape:
    __include: default:/punctuator/full_shape         # 从 default.yaml 导入配置
  half_shape:
    # __include: default:/punctuator/half_shape       # 从 default.yaml 导入配置
    "#": "#"
    "_": "_"
    ",": {commit: "，"}
    ".": {commit: "。"}
    ";": {commit: "；"}
    # ";": [";", "；"]
    "(": ["(", （]
    ")": [")", ）]
    "/": ["/", ／, ÷]
    "{": ['{', 〖, 『, ｛]
    "}": ['}', 〗, 』, ｝]
    '\': ['､', '、', '\', '＼']
    "=": ["=", "≡", "≤", "≥", "≠"]
    "<": ["<", 《, 〈, «, ⟨, ˂, ˱]
    ">": [">", 》, 〉, », ⟩, ˃, ˲]
    "[": ['[', 「, 【, 〔, ［, 〚, 〘]
    "]": [']', 」, 】, 〕, ］, 〛, 〙]
    "`": ["`", "```", ‵, ‶, ‷, ′, ″, ‴, ⁗]
    "|": ["|", ·, ・, ｜, "§", "¦", "‖", ︴]
    "*": ["*", ＊, ·, ・, ×, ※, ❂, ⁂, ☮, ☯, ☣]
    "$": [￥, "$", "€", "£", "¥", "¢", "¤", ₩]
    "%": ["%", ％, "°", "℃", ‰, ‱, ℉, ℅, ℆, ℀, ℁, ⅍]
    "~": ["~", ～, ˜, ˷, ⸯ, ≈, ≋, ≃, ≅, ≇, ∽, ⋍, ≌, ﹏, ﹋, ﹌, ︴]
    "@":
      - "@"
      # - "@xxx.com"
      - "@gmail.com"
      - "@foxmail.com"
      - "@outlook.com"
      - "@hotmail.com"
      - "@qq.com"
      - "@163.com"
      - "@139.com"
  symbols:
    __include: symbols.custom:/symbols

# 从 default 继承快捷键
key_binder:
  bindings:
    - {when: paging,    accept: comma, send: Page_Up}                 # 逗号上一页
    - {when: has_menu,  accept: period, send: Page_Down}              # 句号. 下一页
    # - {when: paging,    accept: minus,  send: Page_Up}              # 减号- 上一页
    # - {when: has_menu,  accept: equal, send: Page_Down}             # 等号= 下一页
    - {when: has_menu,  accept: ";", send_sequence: '{Control+2}'}    # 引号; 用于第2候选
    - {when: has_menu,  accept: "'", send_sequence: '{Control+3}'}    # 引号' 用于第3候选
    # - {when: has_menu,  accept: ".", send_sequence: '{Control+3}'}  # 句号. 用于第3候选
    - {when: composing, accept: Tab, send: Control+Right}
    - {when: composing, accept: Shift+Tab, send: Control+Left}
    - {when: composing, accept: Control+k, send: Shift+Delete}
    - {when: composing, accept: Control+i, send: Control+Left}
    - {when: composing, accept: Control+o, send: Control+Right}
    - {when: always,    accept: Control+Shift+0, select: .next}
    - {when: always,    accept: Control+Shift+G, select: easy_en}
    - {when: composing, accept: Control+w, send: Control+BackSpace}
    - {when: always,    accept: Control+comma, toggle: ascii_punct}
    - {when: always,    accept: Control+period, toggle: full_shape}
    - {when: has_menu,  accept: Control+Shift+5, toggle: charset_hint}
    - {when: has_menu,  accept: Control+Shift+6, toggle: traditionalize}

# 拼写设定
speller:
  # 如果不想让什么标点直接上屏, 可以加在 alphabet, 或者编辑标点符号为两个及以上的映射
  alphabet: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  # initials 定义仅作为始码的按键，排除 ` 让单个的 ` 可以直接上屏
  initials: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  delimiter: " '"
  algebra:
    __include: algebra_common

algebra_common:
  ## 字表编码到输入码的转换规则
  - xform/^ḿ$/om/
  - xform/^m̀$/om/
  - xform/^ńg?$/en/
  - xform/^ňg?$/en/
  - xform/^ǹg?$/en/
  - xform/^ēng$/eng/
  - xform/^(.*)ń(.*)$/$1n$2/
  - xform/^(.*)ň(.*)$/$1n$2/
  - xform/^(.*)ǹ(.*)$/$1n$2/
  - xform/^(.*)ā(.*)$/$1a$2/
  - xform/^(.*)á(.*)$/$1a$2/
  - xform/^(.*)ǎ(.*)$/$1a$2/
  - xform/^(.*)à(.*)$/$1a$2/
  - xform/^(.*)ō(.*)$/$1o$2/
  - xform/^(.*)ó(.*)$/$1o$2/
  - xform/^(.*)ǒ(.*)$/$1o$2/
  - xform/^(.*)ò(.*)$/$1o$2/
  - xform/^(.*)ē(.*)$/$1e$2/
  - xform/^(.*)é(.*)$/$1e$2/
  - xform/^(.*)ě(.*)$/$1e$2/
  - xform/^(.*)è(.*)$/$1e$2/
  - xform/^(.*)ī(.*)$/$1i$2/
  - xform/^(.*)í(.*)$/$1i$2/
  - xform/^(.*)ǐ(.*)$/$1i$2/
  - xform/^(.*)ì(.*)$/$1i$2/
  - xform/^(.*)ū(.*)$/$1u$2/
  - xform/^(.*)ú(.*)$/$1u$2/
  - xform/^(.*)ǔ(.*)$/$1u$2/
  - xform/^(.*)ù(.*)$/$1u$2/
  - xform/^(.*)ǖ(.*)$/$1v$2/
  - xform/^(.*)ǘ(.*)$/$1v$2/
  - xform/^(.*)ǚ(.*)$/$1v$2/
  - xform/^(.*)ǜ(.*)$/$1v$2/
  - xform/^(.*)ü(.*)$/$1v$2/
  - derive/^([jy])u$/$1v/
  - derive/^(e)([in])$/$1$2/
  - derive/^(a)([ion])$/$1$2/
  - xform/^([ae])(ng)?$/$1$1$2/
  - xform/^zh(.*)/Ⓥ$1/
  - xform/^ch(.*)/Ⓘ$1/
  - xform/^sh(.*)/Ⓤ$1/
  - xform/(.)iu$/$1Ⓠ/
  - xform/(.)ei$/$1Ⓦ/
  - xform/(.)uan$/$1Ⓡ/
  - xform/(.)[uv]e$/$1Ⓣ/
  - xform/(.)un$/$1Ⓨ/
  - xform/(.)uo$/$1Ⓞ/
  - xform/(.)ie$/$1Ⓟ/
  - xform/(.)i?ong$/$1Ⓢ/
  - xform/(.)ing$/$1Ⓚ/
  - xform/(.)uai$/$1Ⓚ/
  - xform/(.)ai$/$1Ⓓ/
  - xform/(.)en$/$1Ⓕ/
  - xform/(.)eng$/$1Ⓖ/
  - xform/(.)[iu]ang$/$1Ⓛ/
  - xform/(.)ang$/$1Ⓗ/
  - xform/(.)ian$/$1Ⓜ/
  - xform/(.)an$/$1Ⓙ/
  - xform/(.)ou$/$1Ⓩ/
  - xform/(.)[iu]a$/$1Ⓧ/
  - xform/(.)iao$/$1Ⓝ/
  - xform/(.)ao$/$1Ⓒ/
  - xform/(.)ui$/$1Ⓥ/
  - xform/(.)in$/$1Ⓑ/
  - xlit/ⓆⓌⓇⓉⓎⓊⒾⓄⓅⓈⒹⒻⒼⒽⒿⓀⓁⓏⓍⒸⓋⒷⓃⓂ/qwrtyuiopsdfghjklzxcvbnm/
  - xform/^(..)$/$1/
  - fuzz/^([a-z]).$/$1/
  # - abbrev/^([a-z]).$/$1/

preedit_convert_rules:
  - xform/(\w)g/$1eng/
  - xform/([nl])v/$1ü/
  - xform/([jqxy])v/$1u/
  - xform/([gkhvui])x/$1ua/
  - xform/([gkhvui])k/$1uai/
  - xform/([jqxnlb])l/$1iang/
  - xform/([aoe])\1(\w)/$1$2/
  - xform/([bpmdtnljqx])n/$1iao/
  - xform/([dtgkhvuirzcs])v/$1ui/
  - xform/([dtnlgkhvuirzcs])o/$1uo/
  - xform/([dtnlgkhjqxyvuirzcs])r/$1uan/
  - xform/([jqx])s/$1iong/
  - xform/(\w)b/$1in/
  - xform/(\w)c/$1ao/
  - xform/(\w)d/$1ai/
  - xform/(\w)f/$1en/
  - xform/(\w)h/$1ang/
  - xform/(\w)j/$1an/
  - xform/(\w)k/$1ing/
  - xform/(\w)l/$1uang/
  - xform/(\w)m/$1ian/
  - xform/(\w)p/$1ie/
  - xform/(\w)q/$1iu/
  - xform/(\w)s/$1ong/
  - xform/(\w)t/$1ue/
  - xform/(\w)w/$1ei/
  - xform/(\w)x/$1ia/
  - xform/(\w)y/$1un/
  - xform/(\w)z/$1ou/
  - "xform/(^|[ '])v/$1zh/"
  - "xform/(^|[ '])i/$1ch/"
  - "xform/(^|[ '])u/$1sh/"

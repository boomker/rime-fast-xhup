# Rime schema
# encoding: utf-8

# æ–¹æ¡ˆè¯´æ˜
schema:
  schema_id: flypy_xhfast
  name: é£é¹¤å¿«æ‹¼
  version: "2024.05.05"
  author:
    - boomker
  description: |
    å°é¹¤åŒæ‹¼+è¾…åŠ©ç 
    github.com:boomker/rime-fast-xhup
  dependencies:
    - melt_eng          # è‹±æ–‡å•è¯&è¯ç»„ - ç®€æ˜è‹±æ±‰è¯å…¸(å¢å¼ºç‰ˆ)
    - easy_en
    - flypy_radical
    - flypy_phrase      # ä¸­æ–‡è¯åº“ - ç°ä»£æ±‰è¯­è¯å…¸ & æ¸…åå¼€æºè¯åº“
    # - stroke

switches:
  - name: ascii_mode
    states: [ä¸­, E]
  - name: ascii_punct
    states: [ã€‚, .]
  - name: emoji
    states: [ğŸˆšï¸, ğŸ˜„]
    reset: 1
  - name: full_shape
    states: [åŠè§’, å…¨è§’]
  - name: simplification
    states: [ ç®€, ç¹ ]
  - name: extended_charset
    states: [é€šç”¨, å¢å»£]
    reset: 1
  - name: charset_comment
    states: [ç åŒºæç¤ºå…³, ç åŒºæç¤ºå¼€]
    reset: 0

# è¾“å…¥å¼•æ“
engine:
  processors:
    - lua_processor@pin_word_processor
    - lua_processor@launcher_processor
    - lua_processor@pair_symbols_processor
    - lua_processor@select_char_processor
    - lua_processor@idiom_expand_processor
    - lua_processor@cold_word_drop_processor
    - lua_processor@flypy_switcher_processor
    - lua_processor@word_append_space_processor
    - lua_processor@word_autocommit_processor
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@easy_en
    - affix_segmentor@make_sentence
    - affix_segmentor@laTeX_formula
    - affix_segmentor@radical_lookup
    - affix_segmentor@chinese_number
    - affix_segmentor@flypy_key_help
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
    # - reverse_lookup_translator
    - table_translator@idiom_phrase
    - table_translator@custom_phrase
    - table_translator@melt_eng
    - table_translator@make_sentence                  # ` ç²¾å‡†é€ è¯
    - table_translator@radical_lookup                 # ~ è§¦å‘è¿›å…¥éƒ¨ä»¶ç»„å­—æ¨¡å¼
    - table_translator@easy_en                        # /oe è§¦å‘è¿›å…¥è‹±æ–‡è¾“å…¥æ¨¡å¼
    - table_translator@flypy_key_help                 # /ok è§¦å‘è¿›å…¥åŒæ‹¼é”®ä½å¸®åŠ©
    - lua_translator@pin_word_translator              # è‡ªå®šä¹‰ç½®é¡¶è¯
    - lua_translator@flypy_help_translator            # /oh è§¦å‘è¿›å…¥å¸®åŠ©èœå•
    - lua_translator@lunar_translator                 # /nl è§¦å‘æ˜¾ç¤ºå†œå†
    - lua_translator@datetime_translator              # date, week, time, /wd, /wk, /wt è§¦å‘
    - lua_translator@launcher_translator              # /jj, /fj è§¦å‘å¿«æ·å‘½ä»¤(å¯æ”¹è§¦å‘å‰ç¼€)
    - lua_translator@laTex_translator                 # /lt è§¦å‘ LaTeX è¾“å…¥
    - lua_translator@number_translator                # /cn è§¦å‘ç¹ä½“å¤§å†™é‡‘é¢æ•°å­—
    - lua_translator@commit_history_translator        # /hs è§¦å‘æ˜¾ç¤ºä¸Šå±å†å²
    - lua_translator@idiom_expand_translator          # /,0 ç½®äºè¾“å…¥ç æœ«å°¾è§¦å‘ç®€æ‹¼å±•å¼€
    - lua_translator@word_custom_translator           # ] ç½®äºè¾“å…¥ç æœ«å°¾è§¦å‘è‡ªå®šä¹‰å•è¯å…¥åº“
    - lua_translator@word_autocaps_translator         # A-Z å¤§å†™å­—æ¯å¼€å¤´è§¦å‘å•è¯è‡ªåŠ¨å¤§å†™
    - lua_translator@word_autocommit_translator       # [ å•å­—å…¨ç å’Œéƒ¨åˆ†æˆè¯­çŸ­è¯­è‡ªåŠ¨è§¦å‘
  filters:
    - reverse_lookup_filter@radical_reverse_lookup
    - simplifier@emoji
    - simplifier@traditionalize                       # ç®€ç¹åˆ‡æ¢
    - lua_filter@fly_fixed_filter
    - lua_filter@charset_filter
    - lua_filter@charset_comment_filter
    - lua_filter@word_autocaps_filter
    - lua_filter@emoji_reduce_filter
    - lua_filter@cn_space_en_filter
    - lua_filter@cold_word_drop_filter
    - lua_filter@word_autocommit_filter
    - lua_filter@long_word_up_filter
    - lua_filter@pin_word_filter
    - lua_filter@launcher_filter
    - uniquifier                                      #  åªèƒ½æ”¾åˆ°æœ€å!

grammar:
  language: zh-hans-t-essay-bgw

# ä¸»ç¿»è¯‘å™¨ï¼Œæ‹¼éŸ³
translator:
  dictionary: flypy_xhfast
  spelling_hints: 1                 # `0`: å…³é—­å•å­—ç¼–ç æç¤º
  initial_quality: 1.3
  enable_user_dict: true
  encode_commit_history: true       # ä¸Šå±å†å²è®°å½•
  contextual_suggestions: true      # å¼€å¯å…«è‚¡æ–‡, ä¸Šä¸‹æ–‡è”æƒ³
  sentence_over_completion: true
  # always_show_comments: true
  # enable_encoder: true
  # max_homophones: 7
  comment_format:
    - xform/^\w+[[](\w+)$/~$1/      ## å•å­—ç¼–ç æç¤ºåªæ˜¾ç¤ºè¾…åŠ©ç éƒ¨åˆ†
    - xform/^~\w+\s.*$//            ## å•å­—ç¼–ç æç¤ºåªæ˜¾ç¤ºè¾…åŠ©ç éƒ¨åˆ†

make_sentence:
  __include: /translator            # å¤ç”¨ä¸Šé¢çš„ç¿»è¯‘å™¨, æ—¥å¿— warning å¯å¿½ç•¥
  enable_sentence: true
  prefix: "`"
  tips: "ã€”ç²¾å‡†é€ è¯ã€•"
  tag: make_sentence

# æ¬¡ç¿»è¯‘å™¨ï¼Œè‹±æ–‡
melt_eng:                           # è‹±æ–‡è¾“å…¥
  dictionary: melt_eng
  enable_encoder: false
  enable_sentence: false
  enable_user_dict: false
  enable_completion: true           # æ˜¯å¦å¯ç”¨è‹±æ–‡è¾“å…¥è”æƒ³è¡¥å…¨
  encode_commit_history: false
  initial_quality: 1.1
  comment_format:
    - xform/.*// # æ¸…ç©ºæç¤ºç 

# è‡ªå®šä¹‰çŸ­è¯­ï¼šcustom_phrase.txt
custom_phrase:                      # è‡ªå®šä¹‰çŸ­è¯­, åŒ…å«å›ºé¡¶å­—
  dictionary: ""
  user_dict: custom_phrase
  db_class: stabledb
  enable_completion: false
  enable_sentence: false
  initial_quality: 99

idiom_phrase:                       # æˆè¯­, ä¿—è¯­ç¼©å†™, å®ç°ç®€æ‹¼
  dictionary: ""
  user_dict: idiom_phrase
  db_class: stabledb
  enable_completion: false
  enable_sentence: false
  initial_quality: 0.8

flypy_key_help:
  tag: flypy_key_help
  dictionary: ""
  user_dict: flypy_keymap
  prefix: "/ok"
  tips: "å°é¹¤åŒæ‹¼æŸ¥é”®"
  db_class: stabledb
  enable_completion: true
  enable_sentence: false
  initial_quality: 1

flypy_phrase:
  dictionary: flypy_phrase
  enable_encoder: false
  enable_sentence: false
  enable_completion: true
  enable_user_dict: false
  encode_commit_history: false
  initial_quality: -1

# Emoji
emoji:
  option_name: emoji
  opencc_config: emoji.json
  tag: emoji
  tips: all
  tags: [ abc ]
  inherit_comment: false
  # excluded_types: ["history"]

traditionalize:
  option_name: simplification
  opencc_config: t2s.json   # s2t.json | s2hk.json | s2tw.json | s2twp.json
  tips: none                # è½¬æ¢æç¤º: all éƒ½æ˜¾ç¤º | char ä»…å•å­—æ˜¾ç¤º | none ä¸æ˜¾ç¤ºã€‚
  tags: [abc]               # é™åˆ¶åœ¨å¯¹åº” tagï¼Œä¸å¯¹å…¶ä»–å¦‚åæŸ¥çš„å†…å®¹åšç®€ç¹è½¬æ¢

history:                      # ä¸Šå±å†å²è®°å½•
  tips: "ä¸Šå±å†å²"
  tag: history
  prefix: "/hs"
  size: 30
  history_num_max: 30
  initial_quality: 1000
  excluded_types: ["punct"]

pin_word:                     # è¯æ¡ç½®é¡¶é…ç½®
  pin_word_key: "Control+t"   # è¯æ¡ç½®é¡¶å¿«æ·é”®, ä¼˜å…ˆçº§é«˜äº`key_binder`å…¨å±€é…ç½®
  word_quality: 1000
  comment_mark: "ğŸ”"          # ä¸èƒ½ç•™ç©º
  excluded_types: ["flypy_key_help", "easy_en", "radical_lookup"]

long_word_up:
  # é•¿è¯å‡é¢‘åˆ°ç¬¬ idx ä¸ªä½ç½®
  idx: 3
  excluded_codes: ["date", "rq", "week", "time", "lunar"]

cold_wold_reduce:
  # ç”Ÿåƒ»è¯æ¡é™é¢‘åˆ°ç¬¬ idx ä¸ªä½ç½®
  idx: 4
  excluded_types: ["easy_en"]

emoji_reduce:
  # Emoji é™é¢‘åˆ°ç¬¬ idx ä¸ªä½ç½®
  idx: 6

# æ ‡ç‚¹ç¬¦å·
# punctuator ä¸‹é¢æœ‰ä¸‰ä¸ªå­é¡¹ï¼š
#   full_shape å…¨è§’æ ‡ç‚¹æ˜ å°„
#   half_shape åŠè§’æ ‡ç‚¹æ˜ å°„
#   symbols
punctuator:
  import_preset: symbols
  full_shape:
    __include: default:/punctuator/full_shape         # ä» default.yaml å¯¼å…¥é…ç½®
  half_shape:
    # __include: default:/punctuator/half_shape         # ä» default.yaml å¯¼å…¥é…ç½®
    ",": {commit: "ï¼Œ"}
    ".": {commit: "ã€‚"}
    # ";": {commit: "ï¼›"}         ## å–æ¶ˆæ³¨é‡Šå, ä¸‹è¡Œæ·»åŠ æ³¨é‡Š, ä»¥æ¢å¤é»˜è®¤åˆ†å·
    ";": [";", "ï¼›"]
    '"': {pair: ['â€˜', 'â€™']}      ## æ·»åŠ æ³¨é‡Šåï¼šæ¢å¤é»˜è®¤å¼•å·
    "'": {pair: ['â€œ', 'â€']}      ## æ·»åŠ æ³¨é‡Šåï¼šæ¢å¤é»˜è®¤å¼•å·
    "<": [ã€Š, "<", â€¹, ã€ˆ, Â«, âŸ¨, Ë‚, Ë±]
    ">": [ã€‹, ">", â€º, ã€‰, Â», âŸ©, Ëƒ, Ë²]
    "/": ["/", ï¼, Ã·]
    '\': [ã€, '\', ï¼¼]
    "|": [Â·, ãƒ», "|", ï½œ, "Â§", "Â¦", "â€–", ï¸´]
    "`": ["`", "```", â€µ, â€¶, â€·, â€², â€³, â€´, â—]
    "~": ["~", ï½, Ëœ, Ë·, â¸¯, â‰ˆ, â‰‹, â‰ƒ, â‰…, â‰‡, âˆ½, â‹, â‰Œ, ï¹, ï¹‹, ï¹Œ, ï¸´]
    "%": ["%", ï¼…, "Â°", "â„ƒ", â€°, â€±, â„‰, â„…, â„†, â„€, â„, â…]
    "$": [ï¿¥, "$", "â‚¬", "Â£", "Â¥", "Â¢", "Â¤", â‚©]
    "*": ["*", ï¼Š, Â·, ãƒ», Ã—, â€», â‚, â‚, â˜®, â˜¯, â˜£]
    "[": ['[',ã€Œ, ã€, ã€”, ï¼», ã€š, ã€˜]
    "]": [']', ã€, ã€‘, ã€•, ï¼½, ã€›, ã€™]
    "{": [ã€, ã€–, ï½›]
    "}": [ã€, ã€—, ï½]
    "#": "#"
    "=": "="
    "(": "("
    ")": ")"
    # "@": "@"
  symbols:
    __include: symbols.custom:/symbols

# éƒ¨ä»¶æ‹†å­—åæŸ¥
radical_lookup:
  tag: radical_lookup
  dictionary: flypy_radical
  enable_sentence: false
  enable_user_dict: false
  # enable_completion: true
  prefix: "~"
  suffix: "'"
  tips: ã€”éƒ¨ä»¶ç»„å­—ã€•
  comment_format:
    - erase/^.*$//

# éƒ¨ä»¶æ‹†å­—æ»¤é•œ
radical_reverse_lookup:
  tags: [abc, radical_lookup]
  overwrite_comment: false
  dictionary: kMandarin
  comment_format:
    - xform/^(\w+)[[].*$/$1/
    - xform/^/~/

easy_en:
  tag: easy_en
  dictionary: easy_en
  enable_user_dict: true
  enable_completion: true
  enable_sentence: false
  prefix: "/oe"
  suffix: "'"
  tips: "è‹±æ–‡è¾“å…¥"

# å¤„ç†ç¬¦åˆç‰¹å®šè§„åˆ™çš„è¾“å…¥ç ï¼Œå¦‚ç½‘å€ã€åæŸ¥
recognizer:
  import_preset: default
  patterns:
    week: "^/wk$"
    time: "^/wt$"
    date: "^(/wd|/rq)$"
    chinese_lunar: "^/nl$"
    history: "^/hs$"
    shortcuts: "^/fj$"
    laTeX_formula: "^/lt(.*)$"
    easy_en: "^/oe[a-zA-Z]*$"
    flypy_help: "^/(oh|help)$"
    flypy_key_help: "^/ok[a-z]*$"
    chinese_number: "^/cn[0-9.]*$"
    radical_lookup: "~[a-z]+$"              # ~ å¼•å¯¼éƒ¨ä»¶æ‹†å­—, ä½¿ç”¨å°é¹¤åŒæ‹¼ç¼–ç 
    make_sentence: "^[a-z]+[`][a-z`]*$"     # ` å¼•å¯¼ç²¾å‡†é€ è¯
    punct: "^(/([0-9]0?|[A-Za-z]+))|(;[A-Za-z]+)$"
    url: "^(www[.]|https?:|ftp[.:]|mailto:|file:).*$"

# ä» default ç»§æ‰¿å¿«æ·é”®
key_binder:
  import_preset: default    # ä» default.yaml ç»§æ‰¿é€šç”¨çš„
  # search: "`"               # è¾…ç å¼•å¯¼ç¬¦
  select_first_character: "minus"
  select_last_character: "equal"
  pin_cand: "Control+t"     # å€™é€‰è¯ç½®é¡¶
  drop_cand: "Control+d"    # å¼ºåˆ¶åˆ è¯, æ— è§†è¾“å…¥çš„ç¼–ç 
  hide_cand: "Control+x"    # åŒ¹é…å½“å‰è¾“å…¥ç åéšè—æŒ‡å®šçš„å€™é€‰å­—è¯
  turn_down_cand: "Control+j" # åŒ¹é…å½“å‰è¾“å…¥ç åé™é¢‘æŒ‡å®šçš„å€™é€‰å­—è¯
  switch_comment: "Control+n" # åˆ‡æ¢æ³¨é‡Š(å°é¹¤å½¢ç  / å¸¦è°ƒæ‹¼éŸ³ / æ— )
  commit_comment: "Control+p" # æ³¨é‡Šä¸Šå±
  switch_english: "Control+g" # åˆ‡æ¢åˆ°è‹±æ–‡è¾“å…¥æ¨¡å¼
  bindings:
    - { when: has_menu, accept: semicolon, send: 2 }
    - { when: has_menu, accept: apostrophe, send: 3 } ## å•å¼•å·ç”¨äºç¬¬3å€™é€‰
    - { when: paging, accept: comma, send: Page_Up }  ## é€—å·è¿”å›ä¸Šä¸€é¡µ
    - { when: has_menu, accept: period, send: Page_Down }
    - { when: composing, accept: Control+e, send: End }
    - { when: composing, accept: Control+k, send: Shift+Delete }
    - { when: composing, accept: Control+i, send: Shift+Left }
    - { when: composing, accept: Control+o, send: Shift+Right }
    - { when: composing, accept: Tab, send: Shift+Right }
    - { when: composing, accept: grave, send: "`" }
    - { when: composing, accept: Control+m, send: Return }
    - { when: composing, accept: Control+w, send: Control+BackSpace }
    - { when: has_menu,  accept: Control+0, toggle: simplification }
    - { when: has_menu,  accept: Control+period, toggle: ascii_punct }
    - { when: has_menu,  accept: Control+Shift+slash, toggle: emoji }
    - { when: has_menu,  accept: Control+Shift+apostrophe, toggle: charset_comment }
    # - { when: always, accept: Control+1, send_sequence: 'HelloWorld' }

# æ‹¼å†™è®¾å®š
speller:
  # å¦‚æœä¸æƒ³è®©ä»€ä¹ˆæ ‡ç‚¹ç›´æ¥ä¸Šå±ï¼Œå¯ä»¥åŠ åœ¨ alphabetï¼Œæˆ–è€…ç¼–è¾‘æ ‡ç‚¹ç¬¦å·ä¸ºä¸¤ä¸ªåŠä»¥ä¸Šçš„æ˜ å°„
  alphabet: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA[_/]
  # initials å®šä¹‰ä»…ä½œä¸ºå§‹ç çš„æŒ‰é”®ï¼Œæ’é™¤ ` è®©å•ä¸ªçš„ ` å¯ä»¥ç›´æ¥ä¸Šå±
  initials: zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA
  delimiter: " '"
  algebra:
    - erase/^ng\[kk$/            # å–æ¶ˆã€Œå”” ngã€çš„ç‹¬å 
    - erase/^ng\[kx$/            # å–æ¶ˆã€Œå—¯ ngã€çš„ç‹¬å 
    - erase/^n\[\w+$/            # å–æ¶ˆã€Œå—¯ nã€çš„ç‹¬å 
    - erase/^m\[\w+$/            # å–æ¶ˆã€Œå‘’ mã€çš„ç‹¬å 
    - erase/^m\[\w+$/            # å–æ¶ˆã€Œå‘£ mã€çš„ç‹¬å 

    ## å­—åº“ç¼–ç åˆ°è¾“å…¥ç çš„è½¬æ¢è§„åˆ™
    - derive/^(\w+)\[(\w)(\w)$/$1\[$2$3/        # Flypy: AB[CD
    - derive/^(\w+)\[(\w)(\w)$/$1\[$2/          # Flypy: AB[C
    - derive/^(\w+)\[(\w)(\w)$/$1/              # Flypy: AB

    # å“åº” ` é€ è¯
    - derive/^(\w+)\[(\w)(\w)$/$1`$2$3/        # Flypy: AB`CD
    - derive/^(\w+)\[(\w)(\w)$/$1`$2/          # Flypy: AB`C

    ## æ¨¡ç³ŠéŸ³:
    - derive/^([jqxy])v/$1u/
    - derive/^([jqxy])u/$1v/
    - derive/^(u)([h])/s$2/                   # uh => sh
    - derive/^(z)([^acdefghijklmnsu])/v$2/    # z => zh
    - derive/^(c)([^acdefghijklmsuo])/i$2/    # c => ch
    - derive/^(s)([^abcdefghijklmnu])/u$2/    # s => sh
    - derive/^(i)g/$1f/                       # [zcs][h]eng => [zcs][h]en
    - derive/^([ypdbn])b/$1k/                 # in => ing

    # è¶…çº§ç®€æ‹¼, å¼€å¯åå¯èƒ½æ€§èƒ½ä¸ä½³, è§†æƒ…å†µå¼€å¯
    # è¾“å…¥4ä¸ªæˆ–æ›´å¤šä»¥ä¸‹å­—ç¬¦ï¼ŒæŒ‰ä¸‹`0`è§¦å‘è¶…çº§ç®€æ‹¼
    - abbrev/^(.).+$/$1/

    # å·¦å³å¹¶å‡»é£é”®éŸ³ç è§„åˆ™, æ³¨é‡Šä»¥ä¸‹ä¸‰è¡Œä½¿ç”¨åŸç‰ˆå°é¹¤åŒæ‹¼
  __patch:
    algebra/+:
      __include: flypy_chord_rule:/patch/speller/algebra